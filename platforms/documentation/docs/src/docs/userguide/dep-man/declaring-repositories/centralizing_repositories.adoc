// Copyright (C) 2023 Gradle, Inc.
//
// Licensed under the Creative Commons Attribution-Noncommercial-ShareAlike 4.0 International License.;
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//      https://creativecommons.org/licenses/by-nc-sa/4.0/
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

[[declaring-repositories]]
= Declaring repositories

[[sub:centralized-repository-declaration]]
== Centralizing repositories declaration

Instead of declaring repositories in every subproject of your build or via an `allprojects` block, Gradle offers a way to declare them in a central place for all projects.

NOTE: Central declaration of repositories is an incubating feature.

Repositories used by convention in every subproject can be declared in the `settings.gradle(.kts)` file:

.Declaring a Maven repository in settings
====
include::sample[dir="snippets/artifacts/defineRepositoryInSettings/kotlin",files="settings.gradle.kts[tags=declare_repositories_settings]"]
include::sample[dir="snippets/artifacts/defineRepositoryInSettings/groovy",files="settings.gradle[tags=declare_repositories_settings]"]
====

The `dependencyResolutionManagement` repositories block accepts the same notations as in a project. This includes Maven or Ivy repositories, with or without credentials, etc.

By default, repositories declared by a project in `build.gradle(.kts)` will *override* whatever is declared in `settings.gradle(.kts)`:

.Preferring project repositories
====
include::sample[dir="snippets/artifacts/defineRepositoryInSettings/kotlin",files="settings.gradle.kts[tags=prefer_projects]"]
include::sample[dir="snippets/artifacts/defineRepositoryInSettings/groovy",files="settings.gradle[tags=prefer_projects]"]
====

There are three modes for dependency resolution management:

[cols="1,1,1,1"]
|===
|Mode |Description |Default? |Use-Case

|`PREFER_PROJECT`
|Any repository declared on a project will cause the project to use the repositories declared by the project, ignoring those declared in settings.
|Yes
|Useful when teams need to use different repositories not common among subprojects.

|`PREFER_SETTINGS`
|Any repository declared directly in a project, either directly or via a plugin, will be ignored.
|No
|Useful for enforcing large teams to use approved repositories only, but will not fail the build when a project or plugin declares a repository.

|`FAIL_ON_PROJECT_REPOS`
|Any repository declared directly in a project, either directly or via a plugin, will trigger a build error.
|No
|Useful for enforcing large teams to use approved repositories only.
|===

You can change the behavior to prefer the repositories in the `settings.gradle(.kts)` file by using `repositoriesMode`:

.Preferring settings repositories
====
include::sample[dir="snippets/artifacts/defineRepositoryInSettings/kotlin",files="settings.gradle.kts[tags=prefer_settings]"]
include::sample[dir="snippets/artifacts/defineRepositoryInSettings/groovy",files="settings.gradle[tags=prefer_settings]"]
====

[[sub:fail_build_on_project_repositories]]

Gradle will warn you if a project or a plugin declares a repository in a project.

You can force Gradle to _fail the build_ if you want to enforce that *only* settings repositories are used:

.Enforcing settings repositories
====
include::sample[dir="snippets/artifacts/defineRepositoryInSettings/kotlin",files="settings.gradle.kts[tags=enforce_settings]"]
include::sample[dir="snippets/artifacts/defineRepositoryInSettings/groovy",files="settings.gradle[tags=enforce_settings]"]
====

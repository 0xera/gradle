project(":lib") {
    apply plugin: "cpp-lib"
    apply plugin: "eclipse-cdt"
    apply plugin: 'maven'

    version = 1.0

    uploadArchives {
        repositories {
            mavenDeployer {
                repository(url: uri("${buildDir}/repo"))
            }
        }
    }
}

project(":exe") {
    apply plugin: "cpp-exe"
    apply plugin: "eclipse-cdt"
    apply plugin: "maven"

    version = 1.0
    
    repositories {
        mavenRepo urls: "file://${new File(project(":lib").buildDir, "repo").absolutePath}"
    }

    cpp {
        sourceSets {
            main {
                dependency group: "dependencies", name: "lib", version: "1.0"
            }
        }
    }
    
    uploadArchives {
        repositories {
            mavenDeployer {
                repository(url: uri("${buildDir}/repo"))
            }
        }
    }
}

task build(dependsOn: project(":exe").compileMain)
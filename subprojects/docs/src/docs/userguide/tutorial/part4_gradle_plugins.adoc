// Copyright 2017 the original author or authors.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//      http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

[[part4_gradle_plugins]]
= Part 4: Applying Gradle Plugins

Learn about how Plugins extend Gradle's capabilities and use a popular plugin.

****
**In this section you will:**

- Apply a plugin
- Use the plugin
- Explore other plugins
****

[[part4_begin]]
== Step 0. Before you Begin

1. You initialized your Java app in <<part1_gradle_init.adoc#part1_begin,part 1>>.
2. You ran several tasks in <<part2_gradle_tasks#part2_begin,part 2>>.
3. You learned about dependency management in <<part3_gradle_dep_man#part3_begin,part 3>>.

== Step 1. Understanding Plugins
Plugins are the primary method of distributing custom tasks as packaged code.
They use the Gradle API to provide additional functionality and extend Gradle's core features.

Applying a plugin to a project executes code that can create tasks, configure properties, and otherwise extend the project's capabilities.

Plugins can:

- Add tasks to the project (e.g. compile, test).
- Extend the basic Gradle model (e.g. add new DSL elements that can be configured).
- Configure the project, according to conventions (e.g. add new tasks or configure sensible defaults).
- Apply specific configuration (e.g. add organizational repositories or enforce standards).
- Add new properties and methods to existing types via extensions.

== Step 2. Applying a Plugin
Our project currently applies a single plugin, the `application` plugin:
[source]
----
plugins {
    // Apply the application plugin to add support for building a CLI application in Java.
    application
}
----

There is a plugin that is maintained and distributed by Gradle called the <<distribution_plugin#distribution_plugin,Distribution Plugin>>.
The Distribution Plugin facilitates building archives that serve as distributions of the project.

Apply the plugin by adding `distribution` to the plugins block in `build.gradle.kts`:
[source]
----
plugins {
    // Apply the application plugin to add support for building a CLI application in Java.
    application
    distribution
}
----

Don't forget to sync Gradle if you are using IntelliJ IDEA.

Let's make sure the plugin has been applied by looking at the new tasks it has created.

Run `./gradlew :app:tasks` in your command line:
[source]
----
./gradlew :app:tasks

> Task :app:tasks

------------------------------------------------------------
Tasks runnable from project ':app'
------------------------------------------------------------

...

Distribution tasks
------------------
assembleDist - Assembles the main distributions
distTar - Bundles the project as a distribution.
distZip - Bundles the project as a distribution.
installDist - Installs the project as a distribution as-is.
----

A new set of distribution tasks are now available called `assembleDist`, `distTar`, `distZip` and `installDist`.

Similarly, the new tasks from the Distribution plugin are now available in IntelliJ in the Gradle right-hand pane.

image::tutorial/intellij-idea-plugin.png[]

== Step 3. Using the Plugin
To use the plugin, run the `assembleDist` task by running `./gradlew :app:assembleDist`.
[source]
----
./gradlew :app:assembleDist

BUILD SUCCESSFUL in 577ms
----

The `assembleDist` task builds the project and creates a `app.tar` and `app.zip` distribution in the `build/distributions` directory.

image::tutorial/intellij-idea-dist.png[]

== Step 4. Distributing the App
A TAR or ZIP file can be used internally to distribute the app to peers.

A distribution can also be published to the public using the <<publishing_ivy.adoc#publishing_ivy, Ivy Publish Plugin>> or the <<publishing_maven.adoc#publishing_maven, Maven Publish Plugin>>.

For example, if you wanted to publish your new app to an Ivy repository with the <<publishing_ivy.adoc#publishing_ivy, Ivy Publish Plugin>>, you would modify your build script as follows:
[source]
----
plugins {
    `ivy-publish`
}

publishing {
    publications {
        create<IvyPublication>("myDistribution") {
            artifact(tasks.distZip.get())
            artifact(tasks["customDistTar"])
        }
    }
}
----

== Step 5. Exploring Plugins
Plugin authors can either keep their plugins private or distribute them to the public.

As such, there are three types of plugins:

1. **Core plugins** - Gradle develops and maintains a set of Gradle <<plugin_reference#plugin_reference,Core Plugins>>.
2. **Community plugins** - Gradle has a community of plugin developers who contribute plugins via the https://plugins.gradle.org[Gradle Plugin Portal].
3. **Custom plugins** - Gradle enables user to create custom plugins, that are typically private, to modify the build process beyond the standard Gradle configuration.

Custom plugins are the recommended way to extend build capability and customize Gradle.

[.text-right]
**Next Step:** <<part5_gradle_inc_builds.adoc#part5_begin,Exploring Incremental Builds>> >>

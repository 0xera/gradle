dependencies {
    compile project(':core')
    compile project(':openApi')

    groovy libraries.groovy_depends

    compile libraries.jopt_simple,
            libraries.dom4j,
            libraries.jaxen,
            libraries.commons_io,
            libraries.logback_classic,
            libraries.slf4j_api,
            libraries.jul_to_slf4j,
            libraries.logback_core

    testCompile project(path: ':core', configuration: 'testFixtures')
    testRuntime project(path: ':core', configuration: 'testFixturesRuntime')
}

task integTest(type: AntTest, dependsOn: [ rootProject.intTestImage ]) {
    options.fork(jvmArgs: ["-ea"])
    options.systemProperties['integTest.gradleHomeDir'] = rootProject.intTestImage.integTestGradleHome.absolutePath
    options.systemProperties['integTest.srcDir'] = file('src').absolutePath
    options.systemProperties['integTest.gradleUserHomeDir'] = rootProject.integTest.integTestUserDir.absolutePath
    include 'org/gradle/integtests/**/*IntegrationTest.*'

    doFirst { task -> task.options.systemProperties['integTest.gradleHomeDir'] = rootProject.intTestImage.integTestGradleHome.absolutePath }
}

compileJava.options.depend()

//this is just to exclude integration tests
test {
    // We set forkmode to ONCE as our tests are written in Groovy and the startup time of Groovy is significant.
    options.fork(jvmArgs: ["-ea", '-Xms128m', '-Xmx1g', '-XX:MaxPermSize=128m', '-XX:+HeapDumpOnOutOfMemoryError'])

    exclude 'org/gradle/integtests/**/*.*'
}
